---
import PageLayout from "@/layouts/PageLayout.astro";
import { projectsPageContent } from "@/config";
import BentoBox from "@/components/layout/BentoBox.astro";
import Pill from "@/components/layout/Pill.astro";

const { seo, page, projects } = projectsPageContent;
---

<PageLayout seo={seo} page={page}>
  <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
    {projects.map((project) => {
      const isExternal = project.url?.startsWith("http");
      return (
        <BentoBox
          className="relative overflow-hidden rounded-lg border transition-shadow duration-300 group"
          padding={false}
          hoverHighlight
        >
          {/* Image */}
          <picture>
            {/* Add <source type="image/webp" srcset={project.imageWebp} /> if you have it */}
            <img
              src={project.image}
              alt={project.imageAlt ?? project.title}
              loading="lazy"
              class="h-56 w-full object-cover transition-transform duration-500 group-hover:scale-[1.03] md:h-64"
            />
          </picture>

          {/* Overlay */}
          <a
            href={project.url}
            target={isExternal ? "_blank" : undefined}
            rel={isExternal ? "noreferrer noopener" : undefined}
            aria-label={`Open project: ${project.title}`}
            class="absolute inset-0 flex flex-col"
          >
            {/* gradient + scrim */}
            <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent" />

            {/* content */}
            <div class="mt-auto p-5 md:p-6 relative z-10">
              <div class="mb-2 flex flex-wrap items-center gap-2">
                <h2 class="text-xl font-semibold text-white">
                  {project.title}
                </h2>
                {project.year && (
                  <span class="rounded-md border border-white/15 px-2 py-0.5 text-xs text-white/80">
                    {project.year}
                  </span>
                )}
              </div>

              {/* Tech pills */}
              {project.tech?.length > 0 && (
                <div class="mb-2 flex flex-wrap gap-2">
                  {project.tech.map((t: string) => <Pill text={t} />)}
                </div>
              )}

              {/* Description */}
              {project.description && (
                <p class="max-w-[60ch] text-sm text-white/90 line-clamp-2 md:line-clamp-3">
                  {project.description}
                </p>
              )}

              {/* Subtle CTA affordance */}
              <div class="mt-3 inline-flex items-center gap-2 text-xs font-medium text-white/90 opacity-0 transition-opacity duration-300 group-hover:opacity-100">
                <span>View project</span>
                <svg
                  class="h-3.5 w-3.5"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <path d="M7 17L17 7" />
                  <path d="M7 7h10v10" />
                </svg>
                <span class="sr-only">Open {project.title}</span>
              </div>
            </div>
          </a>
        </BentoBox>
      );
    })}
  </div>
</PageLayout>
